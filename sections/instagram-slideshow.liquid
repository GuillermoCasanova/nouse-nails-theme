{{ 'instagram-slideshow.css' | asset_url | stylesheet_tag }}

<section class="instagram-slideshow color-{{ section.settings.color_scheme }}">
  <div class="container-main section-padding-small">
    {% if section.settings.title != blank %}
      <div class="instagram-slideshow__header">
        <h2 class="instagram-slideshow__title headline-style-h3">{{ section.settings.title | escape }}</h2>
        {% if section.settings.subtitle != blank %}
          <p class="instagram-slideshow__subtitle">{{ section.settings.subtitle | escape }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <div class="instagram-slideshow__container">
        <div class="instagram-slideshow__slider" data-slider>
          {% for block in section.blocks %}
            <div class="instagram-slideshow__slide" {{ block.shopify_attributes }}>
              {% if block.settings.video_url != blank %}
                <div class="instagram-slideshow__video-block">
                  <div class="instagram-slideshow__video-container">
                    <video
                      class="instagram-slideshow__video"
                      controls
                      preload="metadata"
                      poster="{{ block.settings.image | img_url: '400x400', crop: 'center' }}"
                    >
                      <source src="{{ block.settings.video_url }}" type="video/mp4">
                      Your browser does not support the video tag.
                    </video>
                  </div>
                </div>
              {% elsif block.settings.image != blank %}
                <div class="instagram-slideshow__image-block">
                  <div class="instagram-slideshow__image-container">
                    <img
                      class="instagram-slideshow__image responsive-image"
                      src="{{ block.settings.image | img_url: '400x400', crop: 'center' }}"
                      srcset="{{ block.settings.image | img_url: '200x200', crop: 'center' }} 200w, {{ block.settings.image | img_url: '400x400', crop: 'center' }} 400w, {{ block.settings.image | img_url: '600x600', crop: 'center' }} 600w"
                      sizes="(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"
                      alt="{{ block.settings.image.alt | escape }}"
                      width="400"
                      height="400"
                      loading="lazy"
                    >
                  </div>
                </div>
              {% elsif block.settings.product != blank %}
                <div class="instagram-slideshow__product-block">
                  {% assign product = block.settings.product %}
                  <a href="{{ product.url }}" class="instagram-slideshow__product-link">
                    <div class="instagram-slideshow__product-image-container">
                      {% if product.featured_media.preview_image %}
                        <img
                          class="instagram-slideshow__product-image responsive-image"
                          src="{{ product.featured_media.preview_image | img_url: '400x400', crop: 'center' }}"
                          srcset="{{ product.featured_media.preview_image | img_url: '200x200', crop: 'center' }} 200w, {{ product.featured_media.preview_image | img_url: '400x400', crop: 'center' }} 400w, {{ product.featured_media.preview_image | img_url: '600x600', crop: 'center' }} 600w"
                          sizes="(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"
                          alt="{{ product.featured_media.preview_image.alt | escape }}"
                          width="400"
                          height="400"
                          loading="lazy"
                        >
                      {% else %}
                        {{ 'product-1' | placeholder_svg_tag: 'instagram-slideshow__product-placeholder' }}
                      {% endif %}
                    </div>
                    <div class="instagram-slideshow__product-info">
                      <h3 class="instagram-slideshow__product-title">{{ product.title }}</h3>
                      {% include 'product-price-listing', product: product %}
                    </div>
                  </a>
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        {% if section.blocks.size > 1 %}
          <div class="instagram-slideshow__navigation">
            <button
              class="instagram-slideshow__nav-button instagram-slideshow__nav-button--prev"
              aria-label="Previous slide"
            >
              {% include 'icon-chevron-left' %}
            </button>
            <button
              class="instagram-slideshow__nav-button instagram-slideshow__nav-button--next"
              aria-label="Next slide"
            >
              {% include 'icon-chevron-right' %}
            </button>
          </div>
        {% endif %}
      </div>
    {% else %}
      <div class="instagram-slideshow__empty">
        <p>Add blocks to create your Instagram slideshow</p>
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Instagram Slideshow",
  "class": "index-section",
  "settings": [
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Instagram Feed"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subheading"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "slides_to_show",
      "label": "Slides to show",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-play slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Auto-play speed (seconds)",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Instagram Slideshow",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
