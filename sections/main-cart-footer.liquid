{{ 'component-cart.css' | asset_url | stylesheet_tag }}
{{ 'component-totals.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-discounts.css' | asset_url | stylesheet_tag }}

<section class='cart-footer-section color-{{ section.settings.color_scheme }} {{ section.settings.section_padding_top }} {{ section.settings.section_padding_bottom }}'>
  <div
    class='container-x-small {% if cart == empty %} is-empty{% endif %}'
    id='main-cart-footer'
    data-id='{{ section.id }}'
  >
    <div>
      <div class='cart__footer'>
        {%- if settings.show_cart_note -%}
          <cart-note class='cart__note field'>
            <label for='Cart-note'>{{ 'sections.cart.note' | t }}</label>
            <textarea
              class='text-area field__input'
              name='note'
              form='cart'
              id='Cart-note'
              placeholder='{{ 'sections.cart.note' | t }}'
            >{{ cart.note }}</textarea>
          </cart-note>
        {%- endif -%}

        <div class='cart__blocks'>
          {% for block in section.blocks %}
            {%- case block.type -%}
              {%- when '@app' -%}
                {% render block %}
              {%- when 'subtotal' -%}
                <div class='js-contents' {{ block.shopify_attributes }}>
                  <div class='totals'>
                    <h3 class='totals__subtotal'>
                      {{ 'sections.cart.subtotal' | t }}
                    </h3>
                    <p class='totals__subtotal-value'>
                      {{ cart.total_price | money_with_currency }}
                    </p>
                  </div>

                  <div>
                    {%- if cart.cart_level_discount_applications.size > 0 -%}
                      <ul
                        class='discounts list-unstyled'
                        role='list'
                        aria-label='{{ 'customer.order.discount' | t }}'
                      >
                        {%- for discount in cart.cart_level_discount_applications -%}
                          <li class='discounts__discount discounts__discount--position'>
                            {%- render 'icon-discount' -%}
                            {{ discount.title }}
                            (-{{ discount.total_allocated_amount | money }})
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>

                  <small class='tax-note caption-large rte'>
                    {%- if cart.taxes_included
                      and shop.shipping_policy.body != blank
                    -%}
                      {{
                        'sections.cart.taxes_included_and_shipping_policy_html'
                        | t: link: shop.shipping_policy.url
                      }}
                    {%- elsif cart.taxes_included -%}
                      {{
                        'sections.cart.taxes_included_but_shipping_at_checkout'
                        | t
                      }}
                    {%- elsif shop.shipping_policy.body != blank -%}
                      {{
                        'sections.cart.taxes_and_shipping_policy_at_checkout_html'
                        | t: link: shop.shipping_policy.url
                      }}
                    {%- else -%}
                      {{ 'sections.cart.taxes_and_shipping_at_checkout' | t }}
                    {%- endif -%}
                  </small>
                </div>
              {%- else -%}
                <div class='cart__ctas' {{ block.shopify_attributes }}>
                  <noscript>
                    <button
                      type='submit'
                      class='cart__update-button button button--secondary'
                      form='cart'
                    >
                      {{ 'sections.cart.update' | t }}
                    </button>
                  </noscript>

                  <button
                    type='submit'
                    id='checkout'
                    class='cart__checkout-button button button--primary button--large'
                    name='checkout'
                    {% if cart == empty %}
                      disabled
                    {% endif %}
                    form='cart'
                  >
                    {{ 'sections.cart.checkout' | t }}
                  </button>
                </div>

                {%- if additional_checkout_buttons -%}
                  <div class='cart__dynamic-checkout-buttons additional-checkout-buttons'>
                    {{ content_for_additional_checkout_buttons }}
                  </div>
                {%- endif -%}
            {%- endcase -%}
          {% endfor %}

          <div id='cart-errors'></div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    function isIE() {
      const ua = window.navigator.userAgent;
      const msie = ua.indexOf('MSIE ');
      const trident = ua.indexOf('Trident/');

      return msie > 0 || trident > 0;
    }

    if (!isIE()) return;
    const cartSubmitInput = document.createElement('input');
    cartSubmitInput.setAttribute('name', 'checkout');
    cartSubmitInput.setAttribute('type', 'hidden');
    document.querySelector('#cart').appendChild(cartSubmitInput);
    document
      .querySelector('#checkout')
      .addEventListener('click', function (event) {
        document.querySelector('#cart').submit();
      });
  });
</script>

{% schema %}
{
  "name": "Cart Footer",
  "class": "cart__footer-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Color Scheme"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "section_padding_top",
      "label": "Section Padding Top",
      "options": [
        {
          "value": "section-padding-top-none",
          "label": "None"
        },
        {
          "value": "section-padding-top-x-small",
          "label": "Extra Small"
        },
        {
          "value": "section-padding-top-small",
          "label": "Small"
        },
        {
          "value": "section-padding-top-main",
          "label": "Medium"
        },
        {
          "value": "section-padding-top-large",
          "label": "Large"
        }
      ],
      "default": "section-padding-top-x-small"
    },
    {
      "type": "select",
      "id": "section_padding_bottom",
      "label": "Section Padding Bottom",
      "options": [
        {
          "value": "section-padding-bottom-none",
          "label": "None"
        },
        {
          "value": "section-padding-bottom-x-small",
          "label": "Extra Small"
        },
        {
          "value": "section-padding-bottom-small",
          "label": "Small"
        },
        {
          "value": "section-padding-bottom-main",
          "label": "Medium"
        },
        {
          "value": "section-padding-bottom-large",
          "label": "Large"
        }
      ],
      "default": "section-padding-bottom-small"
    }
  ],
  "blocks": [
    {
      "type": "subtotal",
      "name": "t:sections.main-cart-footer.blocks.subtotal.name",
      "limit": 1
    },
    {
      "type": "buttons",
      "name": "t:sections.main-cart-footer.blocks.buttons.name",
      "limit": 1
    },
    {
      "type": "@app"
    }
  ],
  "presets": [
    {
      "name": "Cart Footer",
      "category": "E-commerce"
    }
  ]
}
{% endschema %}
