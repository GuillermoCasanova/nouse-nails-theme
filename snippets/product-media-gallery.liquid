{% comment %}
  Renders a product media gallery. Should be used with 'media-gallery.js'
  Also see 'product-media-modal'

  Accepts:
  - product: {Object} Product liquid object
  - variant_images: {Array} Product images associated with a variant
  - limit: {Number} (optional) When passed, limits the number of media items to render

  Usage:
  {% render 'product-media-gallery' %}
{% endcomment %}

{%- liquid
  if section.settings.hide_variants and variant_images.size == product.media.size
    assign single_media_visible = true
  endif

  if limit == 1
    assign single_media_visible = true
  endif

  assign media_count = product.media.size
  if section.settings.hide_variants and media_count > 1 and variant_images.size > 0
    assign media_count = media_count | minus: variant_images.size | plus: 1
  endif

  if media_count == 1 or single_media_visible
    assign single_media_visible_mobile = true
  endif

  if media_count == 0 or single_media_visible_mobile or section.settings.mobile_thumbnails == 'show' or section.settings.mobile_thumbnails == 'columns' and media_count < 3
    assign hide_mobile_slider = true
  endif

  if section.settings.media_size == 'large'
    assign media_width = 0.65
  elsif section.settings.media_size == 'medium'
    assign media_width = 0.55
  elsif section.settings.media_size == 'small'
    assign media_width = 0.45
  endif
-%}

{{ 'component-product-media-gallery.css' | asset_url | stylesheet_tag }}
{{ 'swiper.css' | asset_url | stylesheet_tag }}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer></script>
<script src="{{ 'swiper-slideshow.js' | asset_url }}" defer></script>

<media-gallery
  id="MediaGallery-{{ section.id }}"
  role="region"
  class="product__column-sticky"
  aria-label="{{ 'products.product.media.gallery_viewer' | t }}"
  data-desktop-layout="{{ section.settings.gallery_layout }}"
>
  <div id="GalleryStatus-{{ section.id }}" class="visually-hidden" role="status"></div>

  <swiper-slideshow
    class="product-media-gallery__main"
    mobile-slides-per-view="1"
    mobile-space-between="0"
    mobile-centered-slides="false"
    mobile-loop="true"
    mobile-autoplay="false"
    show-navigation="true"
    show-pagination="true"
    effect="fade"
    speed="400"
    create-elements="true"
    thumbnails="data-thumbnails-gallery"
  >
    <div class="swiper" data-swiper-slideshow>
      <div class="swiper-wrapper" data-swiper-slideshow-wrapper>
        {%- if product.selected_or_first_available_variant.featured_media != null -%}
          {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
          <div class="swiper-slide" data-swiper-slide>
            <div class="product__media-item-wrapper">
              {% render 'product-thumbnail',
                media: featured_media,
                media_count: media_count,
                position: 1,
                desktop_layout: section.settings.gallery_layout,
                mobile_layout: section.settings.mobile_thumbnails,
                loop: section.settings.enable_video_looping,
                modal_id: section.id,
                xr_button: true,
                media_width: media_width,
                media_fit: section.settings.media_fit,
                constrain_to_viewport: section.settings.constrain_to_viewport,
                lazy_load: false,
                zoom: true,
                a11y: true,
                aspect_ratio: media_aspect_ratio
              %}
            </div>
          </div>
        {%- endif -%}

        {%- for media in product.media -%}
          {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
            <div class="swiper-slide" data-swiper-slide>
              <div class="product__media-item-wrapper">
                {% render 'product-thumbnail',
                  media: media,
                  media_count: media_count,
                  position: forloop.index,
                  desktop_layout: section.settings.gallery_layout,
                  mobile_layout: section.settings.mobile_thumbnails,
                  loop: section.settings.enable_video_looping,
                  modal_id: section.id,
                  xr_button: true,
                  media_width: media_width,
                  media_fit: section.settings.media_fit,
                  constrain_to_viewport: section.settings.constrain_to_viewport,
                  lazy_load: true,
                  zoom: true,
                  a11y: true,
                  aspect_ratio: media_aspect_ratio
                %}
              </div>
            </div>
          {%- endunless -%}
        {%- endfor -%}
      </div>
    </div>
  </swiper-slideshow>

  <swiper-slideshow
    class="product-media-gallery__thumbnails"
    mobile-slides-per-view="4"
    mobile-space-between="10"
    mobile-centered-slides="false"
    mobile-loop="false"
    mobile-autoplay="false"
    show-navigation="false"
    show-pagination="false"
    effect="slide"
    speed="400"
    slides-per-view="8"
    create-elements="true"
    data-thumbnails-gallery
    direction="vertical"
  >
    <div class="swiper" data-swiper-slideshow>
      <div class="swiper-wrapper" data-swiper-slideshow-wrapper>
        {%- if product.selected_or_first_available_variant.featured_media != null -%}
          {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
          <div class="swiper-slide" data-swiper-slide>
            <div class="product__media-thumbnail-wrapper">
              {% render 'product-thumbnail',
                media: featured_media,
                media_count: media_count,
                position: 1,
                desktop_layout: 'thumbnail',
                mobile_layout: 'thumbnail',
                loop: section.settings.enable_video_looping,
                modal_id: section.id,
                xr_button: false,
                media_width: 0.25,
                media_fit: 'contain',
                constrain_to_viewport: true,
                lazy_load: false,
                zoom: false,
                aspect_ratio: media_aspect_ratio,
                class: 'product-media-gallery__thumbnail'
              %}
            </div>
          </div>
        {%- endif -%}

        {%- for media in product.media -%}
          {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
            <div class="swiper-slide" data-swiper-slide>
              <div class="product__media-thumbnail-wrapper">
                {% render 'product-thumbnail',
                  media: media,
                  media_count: media_count,
                  position: forloop.index,
                  desktop_layout: 'thumbnail',
                  mobile_layout: 'thumbnail',
                  loop: section.settings.enable_video_looping,
                  modal_id: section.id,
                  xr_button: false,
                  media_width: 0.25,
                  media_fit: 'contain',
                  constrain_to_viewport: true,
                  lazy_load: true,
                  zoom: false,
                  aspect_ratio: media_aspect_ratio,
                  class: 'product-media-gallery__thumbnail'
                %}
              </div>
            </div>
          {%- endunless -%}
        {%- endfor -%}
      </div>
    </div>
  </swiper-slideshow>
</media-gallery>
